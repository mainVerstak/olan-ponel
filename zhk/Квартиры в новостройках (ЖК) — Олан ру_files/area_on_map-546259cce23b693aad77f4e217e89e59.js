(function(){var Q=[].slice;define("area_on_map_module",["jquery","extend_utils"],function(r){var a,i,u,s,o,n,l,e,c,d,f,A,p,m,t,g,y,R,v,_,D,E,S,b,T,h,C,w,W,M,I,N,x,L,G,O,P,k,q,B,j,z,H,F,J,K;return g=[55.753215,37.622504],l=["drag","rightMouseButtonMagnifier"],o=1e-6,n=.001,c=10,e=4,(I={})[""+(u={DRAW_AREA:"draw_area",START_DRAWING:"start_drawing",DELETE_AREA:"delete_area"}).DRAW_AREA]="\u041d\u0430\u0440\u0438\u0441\u043e\u0432\u0430\u0442\u044c \u043e\u0431\u043b\u0430\u0441\u0442\u044c",I[""+u.START_DRAWING]="\u041d\u0430\u0447\u043d\u0438\u0442\u0435 \u0440\u0438\u0441\u043e\u0432\u0430\u0442\u044c",I[""+u.DELETE_AREA]="\u0423\u0434\u0430\u043b\u0438\u0442\u044c \u043e\u0431\u043b\u0430\u0441\u0442\u044c",s=I,(N={})[""+u.DRAW_AREA]="fas fa-paint-brush",N[""+u.START_DRAWING]="fas fa-paint-brush",N[""+u.DELETE_AREA]="fas fa-eraser",i=N,(x={})[""+u.DRAW_AREA]="",x[""+u.START_DRAWING]="active",x[""+u.DELETE_AREA]="",a=x,W={element:null,center:null,buttonState:u.DRAW_AREA,polygon:null,lineCoordinates:[],isMouseDown:!1},j=r.extend({},W),y={initState:function(t){var e,n,o;return n=t.element,e=t.center,o=t.polygon,j=r.extend({},W,{element:n,center:e,polygon:o})},resetState:function(){return j=r.extend({},W)},setButtonState:function(t){return j=r.extend({},j,{buttonState:t})},setPolygon:function(t){return j=r.extend({},j,{polygon:t})},setIsMouseDown:function(t){return j=r.extend({},j,{isMouseDown:t})},resetLineCoordinates:function(){return j=r.extend({},j,{lineCoordinates:[]})},addLineCoordinate:function(t){var e,n;if(!(e=(n=j.lineCoordinates)[n.length-1])||!ymaps.util.math.areEqual(t,e,o))return j=r.extend({},j,{lineCoordinates:Q.call(j.lineCoordinates).concat([t])})}},O=G=t=p=M=null,L={strokeColor:"#00ff00",strokeOpacity:.5,strokeWidth:3,fillColor:"#00ff00",fillOpacity:.2},S=function(){switch(j.buttonState){case u.DRAW_AREA:return J();case u.START_DRAWING:case u.DELETE_AREA:return F()}},F=function(){if(y.setButtonState(u.DRAW_AREA),y.setPolygon(null),y.resetLineCoordinates(),P(),t&&t.remove(),G)return M.geoObjects.remove(G)},J=function(){return y.setButtonState(u.START_DRAWING),y.setPolygon(null),P(),t=M.cursors.push("arrow")},H=function(){if(y.setButtonState(u.DELETE_AREA),P(),t)return t.remove()},P=function(){var t;return t=j.buttonState,p.data.set("content",s[t]),p.data.set("icon",i[t]),p.data.set("className",a[t])},f=function(t){return G=new ymaps.Polygon([t],{},L),M.geoObjects.add(G),H()},A=function(t){return O=new ymaps.Polyline(t,{},{strokeColor:"#00ff00",strokeWidth:4,strokeOpacity:.5,cursor:"arrow",hasHint:!1,hasBalloon:!1,openHintOnHover:!1,interactivityModel:"default#silent",zIndex:0}),M.geoObjects.add(O)},z=function(){if(O)return O.geometry.setCoordinates([])},K=function(){var t;return t=j.lineCoordinates,O?O.geometry.setCoordinates(t):A(t)},_=function(t){return M.behaviors.disable(l),z(),y.setIsMouseDown(!0),y.resetLineCoordinates(),R(t)},R=function(t){return y.addLineCoordinate(t),K()},v=function(){var t,e,n;return n=j.lineCoordinates,M.behaviors.enable(l),e=n[0],y.setIsMouseDown(!1),y.addLineCoordinate(e),z(),t=E(),y.setPolygon(t),t&&2<t.length?f(t):F()},q=function(t,e){var n,o,r,a,i;for(i=e*e,a=[t[0]],r=t[0],o=1;o<t.length;)n=t[o],Math.pow(r[0]-n[0],2)+Math.pow(r[1]-n[1],2)>i&&(a.push(n),r=n),o++;return a},B=function(t,e,n){var o;return t.length<=e?t:(o=q(t,n)).length<=e?o:B(t,e,n*(c/100+1))},m=function(t){return t.map(function(t){return t.map(function(t){return Number(t.toFixed(e))})})},E=function(){var t,e;return t=j.lineCoordinates,e=B(t,50,n),m(e)},b=function(t){if(j.buttonState===u.START_DRAWING)return _(t.get("coords"))},C=function(){var t,e;if(t=j.buttonState,e=j.isMouseDown,t===u.START_DRAWING&&e)return v()},h=function(t){var e,n;if(e=j.buttonState,n=j.isMouseDown,e===u.START_DRAWING&&n)return R(t.get("coords"))},T=function(t){var e,n,o,r;if(e=j.buttonState,n=j.isMouseDown,e===u.START_DRAWING&&n&&(!(o=(r=t.get("relatedTarget"))&&r.getShape&&r.getShape())||!o.equals(O._geoObjectComponent.getOverlaySync().getShape())))return v()},d=function(){var t,e,n,o;return e=j.buttonState,o='<div class="btn btn-default {{ data.className }}">\n  <i class="{{ data.icon }}" />\n  {{ data.content }}\n</div>',t=ymaps.templateLayoutFactory.createClass(o),n={data:{content:s[e],icon:i[e],className:a[e]},options:{layout:t}},(p=new ymaps.control.Button(n)).events.add("click",S),M.controls.add(p)},w=function(){var t,e,n,o;return e=j.element,t=j.center,o=j.polygon,r(".map_loading").remove(),n={center:t,zoom:12,controls:["fullscreenControl","geolocationControl","zoomControl"]},o&&(n.bounds=ymaps.util.bounds.fromPoints(o)),M=new ymaps.Map(e,n,{yandexMapDisablePoiInteractivity:!0}),d(),o&&f(o),M.events.add("mousedown",b),M.events.add("mouseup",C),M.events.add("mousemove",h),M.events.add("mouseleave",T)},D=function(){return r(".type-button-locations-action:first").trigger("click"),r("#area_on_map_btn").addClass("hidden"),r(".map_loading").remove(),require(["bootstrap_notify"],function(){return r(".notifications").notify({message:{text:"\u041d\u0435 \u0443\u0434\u0430\u043b\u043e\u0441\u044c \u0437\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044c \u042f\u043d\u0434\u0435\u043a\u0441.\u041a\u0430\u0440\u0442\u044b"},type:"danger"}).show()})},{init:function(t){var e,n,o,r;return n=t.element,o=t.point,r=t.polygon,k(),e=o||g,y.initState({element:n,center:e,polygon:r}),require(["ymaps"],function(){return ymaps.ready(w)},function(t){if("ymaps"===(t.requireModules&&t.requireModules[0]))return D()})},reset:k=function(){return M&&M.destroy(),y.resetState(),O=G=t=p=M=null},getPolygon:function(){return j.polygon}}})}).call(this);